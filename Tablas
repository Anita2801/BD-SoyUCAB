--Create Table 

--Lugar 
Create table Lugar 
(ISO_Lugar varchar(10) PRIMARY KEY,
Nombre_L varchar (20) NOT NULL,
Tipo_L varchar (15) NOT NULL,
ISO_Superior varchar(10), 
CONSTRAINT FK_ISO_Superior FOREIGN KEY (ISO_Superior) REFERENCES Lugar (ISO_Lugar),
CONSTRAINT C_Tipo_Lugar CHECK (Tipo_L in ('País', 'Estado'))); 

--Usuario
Create table Usuario 
(Cuenta varchar (15) PRIMARY KEY); 

--Idioma 
Create table Idioma 
(ISO_Idioma varchar (3) Primary KEY,
Idioma varchar (12) NOT NULL);

--Persona 
Create table Persona 
(CI varchar (15) PRIMARY KEY,
Persona_Usuario varchar (15) NOT NULL UNIQUE,
Primer_Nombre varchar (15) NOT NULL,
Segundo_Nombre varchar (15),
Primer_Apellido varchar (15) NOT NULL, 
Segundo_Apellido varchar (15) NOT NULL, 
Sexo varchar (10) NOT NULL,
Ubicacion_Persona varchar (10) NOT NULL, 
CONSTRAINT FK_Persona_Cuenta FOREIGN KEY (Persona_Usuario) REFERENCES Usuario (Cuenta),
CONSTRAINT C_Sexo CHECK (sexo in ('Masculino', 'Femenino')),
CONSTRAINT FK_ubi_Persona FOREIGN KEY (Ubicacion_Persona) REFERENCES Lugar (ISO_Lugar)); 

--Organización 
Create table Organizacion_Asociada 
(RIF varchar (15) PRIMARY KEY,
OA_Usuario varchar (15) NOT NULL UNIQUE,
Nombre_O varchar (30) NOT NULL, 
Ubicacion_OA varchar (10) NOT NULL, 
CONSTRAINT FK_OA_Cuenta FOREIGN KEY (OA_Usuario) REFERENCES Usuario (Cuenta),
CONSTRAINT FK_Ubi_OA FOREIGN KEY (Ubicacion_OA) REFERENCES Lugar (ISO_Lugar));

--Entidad Institucional
Create table Entidad_Institucional
(Cod_Inst varchar (10) PRIMARY KEY,
Nombre_Ent_Inst varchar (50) NOT NULL,
Cod_Inst_Sup varchar (10),
CONSTRAINT FK_Cod_Inst FOREIGN KEY (Cod_Inst_Sup) REFERENCES Entidad_Institucional (Cod_Inst));

--Rol
Create table Rol 
(Tipo_Rol varchar (20) PRIMARY KEY, 
CONSTRAINT C_Tipo_Rol check (Tipo_Rol in ('Estudiante', 'Profesor', 'Empleado', 'Egresado')));

--Habilidad 
Create table Habilidad 
(Habilidad varchar (20) PRIMARY KEY); 


--Contenido 
Create table Contenido
(Usuario_Creador varchar (15) NOT NULL,
FechaHora_Creacion TIMESTAMP (6) NOT NULL DEFAULT CURRENT_TIMESTAMP,
Nro_Me_Gusta INTEGER DEFAULT 0,
Nro_No_Me_Gusta INTEGER DEFAULT 0,
PRIMARY KEY (Usuario_Creador, FechaHora_Creacion),
CONSTRAINT FK_Usuario_Creador FOREIGN KEY (Usuario_Creador) REFERENCES Usuario (Cuenta));


--Reacciona 
Create table Reacciona 
(Usuario_Reacciona varchar (15) NOT NULL,
Usuario_Contenido varchar (15) NOT NULL,
FechaHora_Contenido TIMESTAMP (6) NOT NULL,
Reaccion varchar (10) NOT NULL,
PRIMARY KEY (Usuario_Reacciona, Usuario_Contenido, FechaHora_Contenido),
CONSTRAINT FK_U_Reacciona FOREIGN KEY (Usuario_Reacciona) REFERENCES Usuario (Cuenta),
CONSTRAINT FK_U_Contenido FOREIGN KEY (Usuario_Contenido, FechaHora_Contenido) REFERENCES Contenido (Usuario_Creador, FechaHora_Creacion),
CONSTRAINT Tipo_Reaccion CHECK (Reaccion in ('Me Gusta', 'No Me Gusta')));

--Evento
Create table Evento 
(Nombre_Evento varchar (30) NOT NULL,
Fecha_Evento DATETIME NOT NULL,
Usuario_Evento varchar (15) NOT NULL,
Desc_Evento varchar (200),
PRIMARY KEY (Nombre_Evento, Fecha_Evento, Usuario_Evento),
CONSTRAINT FK_U_Evento FOREIGN KEY (Usuario_Evento) REFERENCES Usuario (Cuenta));

--CHAT
Create Table Chat 
(Nombre_Chat VARCHAR (30) NOT NULL,
Fecha_Creacion_Chat TIMESTAMP (6) NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (Nombre_Chat, Fecha_Creacion_Chat));

--Chat_Miembro
Create table Chat_Miembro
(Chat_Participa varchar (30) NOT NULL,
Fecha_Chat TIMESTAMP(6) NOT NULL,
Usuario_Chat varchar (15) NOT NULL,
Rol_Chat varchar (10) NOT NULL, 
PRIMARY KEY (Chat_Participa, Fecha_Chat, Usuario_Chat),
CONSTRAINT FK_Chat_Participa FOREIGN KEY (Chat_Participa, Fecha_Chat) REFERENCES Chat (Nombre_Chat, Fecha_Creacion_Chat),
CONSTRAINT FK_U_CHAT FOREIGN KEY (Usuario_Chat) REFERENCES Usuario (Cuenta),
CONSTRAINT Tipo_Rol_Chat check (Rol_Chat in ('Miembro', 'Administrador', 'Creador')));

--Habla
CREATE TABLE Habla 
(CI_Persona VARCHAR(15) NOT NULL,
ISO_Idioma VARCHAR(3) NOT NULL,
Nivel_Fluidez VARCHAR(20),
PRIMARY KEY (CI_Persona, ISO_Idioma),
CONSTRAINT FK_Habla_Persona FOREIGN KEY (CI_Persona) REFERENCES Persona (CI),
CONSTRAINT FK_Habla_Idioma FOREIGN KEY (ISO_Idioma) REFERENCES Idioma (ISO_Idioma),
CONSTRAINT C_Nivel_Fluidez CHECK (Nivel_Fluidez IN ('Básico', 'Intermedio', 'Avanzado', 'Nativo')));

--Se_Relaciona 
Create table Se_Relaciona
(Usuario_Receptor VARCHAR(15) NOT NULL,
Usuario_Solicitante VARCHAR(15) NOT NULL, 
Tipo_Relacion VARCHAR(15) NOT NULL,
Estado_Relacion VARCHAR(15) NOT NULL,
PRIMARY KEY (Usuario_Receptor, Usuario_Solicitante),
CONSTRAINT FK_U_Receptor FOREIGN KEY (Usuario_Receptor) REFERENCES Usuario (Cuenta),
CONSTRAINT FK_U_Solicitante FOREIGN KEY (Usuario_Solicitante) REFERENCES Usuario (Cuenta),
CONSTRAINT C_Tipo_Relacion CHECK (Tipo_Relacion in ('Seguimiento', 'Amistad')));

--Grupo
Create table Grupo 
(Nombre_Grupo VARCHAR (30) PRIMARY KEY,
Desc_Grupo varchar (300),
Tipo_Grupo varchar (12));

--Grupo_Participa 
CREATE TABLE Grupo_Participa 
(Nombre_Grupo VARCHAR(30) NOT NULL,
Usuario_Miembro VARCHAR(15) NOT NULL,    
Rol_Miembro VARCHAR(15) NOT NULL,
PRIMARY KEY (Nombre_Grupo, Usuario_Miembro),
CONSTRAINT FK_Grupo_Relacion FOREIGN KEY (Nombre_Grupo) REFERENCES Grupo (Nombre_Grupo),
CONSTRAINT FK_Miembro_Relacion FOREIGN KEY (Usuario_Miembro) REFERENCES Usuario (Cuenta),
CONSTRAINT CK_Rol_Miembro CHECK (Rol_Miembro IN ('Miembro', 'Moderador', 'Fundador')));

--Publicación 
Create Table Publicacion 
(Titulo_Pub varchar (50) PRIMARY KEY,
Autor varchar (15) NOT NULL,
Sinopsis_Pub varchar (400) NOT NULL, 
Fecha_Pub DATETIME NOT NULL, 
PRIMARY KEY (Titulo_Pub, Autor), 
CONSTRAINT FK_Autor FOREIGN KEY (Autor) REFERENCES Usuario (Cuenta));


--Descripcion
Create Table Descripcion
(Descripcion VARCHAR (200) NOT NULL,
Cuenta_Desc VARCHAR (15) NOT NULL,
PRIMARY KEY (Descripcion, Cuenta_Desc),
CONSTRAINT FK_Desc FOREIGN KEY (Cuenta_Desc) REFERENCES Usuario (Cuenta));


--Capacidad Habilidad
Create table Capacidad_Hab
(CI varchar (15) NOT NULL,
Habilidad varchar (20) NOT NULL,
Primary key (CI, Habilidad),
CONSTRAINT HAB_CI FOREIGN KEY (CI) REFERENCES Persona (CI),
CONSTRAINT HAB_HAB FOREIGN KEY (Habilidad) REFERENCES Habilidad (Habilidad));


--Desempeña 
Create Table Desempeña 
(CI_Rol varchar (15) NOT NULL,
Des_Rol varchar (20) NOT NULL, 
Primary key (CI_Rol, Des_Rol), 
CONSTRAINT FK_CI_Rol FOREIGN KEY (CI_Rol) REFERENCES Persona (CI),
CONSTRAINT FK_Des_Rol FOREIGN KEY (Des_Rol) REFERENCES Rol (Tipo_Rol));

--Nexo 
Create table Nexo 
(Cod_Inst_Nexo varchar (10) NOT NULL,
CI_Nexo varchar (15) NOT NULL, , 
Primary Key (Cod_Inst_Nexo, CI_Nexo),
CONSTRAINT FK_COD_INST_NEXO FOREIGN KEY (Cod_Inst_Nexo) REFERENCES Entidad_Institucional (Cod_Inst),
CONSTRAINT FK_CI_NEXO FOREIGN KEY (CI_Nexo) REFERENCES Persona (CI));


--tIEMPO Duracion 
Create table Tiempo_Duracion 
(Inst_T varchar (10) NOT NULL,
CI_T varchar (15) NOT NULL,
Rol_T varchar (20) NOT NULL,
Fecha_Inicio DATE NOT NULL,
Fecha_Fin DATE,
PRIMARY KEY (INST_T, CI_T, ROL_T),
CONSTRAINT FK_Nexo FOREIGN KEY (Inst_T, CI_T) REFERENCES Nexo (Cod_Inst_Nexo, CI_Nexo),
CONSTRAINT FK_Desempena FOREIGN KEY (CI_T, ROL_T) REFERENCES Desempeña (CI_Rol, Des_Rol)
CONSTRAINT CK_Fecha_Duracion CHECK (Fecha_Fin IS NULL OR Fecha_Fin >= Fecha_Inicio));
